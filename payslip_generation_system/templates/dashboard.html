{% extends "includes/base.html" %}

{% block title %}DENR NCR - PaGeS{% endblock title %}

{% block content %}
    <table id="employeeTable" class="table table-responsive table-striped table-bordered table-sm" cellspacing="0" width="100%" >
        <thead>
            <tr>
                <th>Fullname</th>
                <th>Date Hired</th>
                <th>Position</th>
                <th>Education</th>
                <th>Birthdate</th>
                <th>Gender</th>
                <th>Fund Source</th>
                <th>Tax Declared</th>
                <th>Salary</th>
                <th>Eligibility</th>
                <th>Action</th>
            </tr>
        </thead>
    </table>

    <script>
        $(document).ready(function() {
            $('#employeeTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: "{% url 'employee_data_json' %}"
            });

            // Edit button click
            $(document).on('click', '.edit-btn', function() {
                var empId = $(this).data('id');
                window.location.href = '/employee/edit/' + empId + '/';
            });

            // Delete button click
            $(document).on('click', '.delete-btn', function() {
                var empId = $(this).data('id');
                
                // Confirm deletion
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'This action cannot be undone!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Perform AJAX request to delete the employee
                        $.ajax({
                            type: 'POST',
                            url: '/employee/delete/' + empId + '/',
                            data: {
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            success: function(response) {
                                if (response.success) {
                                    Swal.fire(
                                        'Deleted!',
                                        'The employee record has been deleted.',
                                        'success'
                                    ).then(function() {
                                        location.reload();  // Reload the page after deletion
                                    });
                                }
                            },
                            error: function(xhr, status, error) {
                                Swal.fire(
                                    'Error!',
                                    'There was an error while deleting the employee.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        });
    </script>
{% endblock %}